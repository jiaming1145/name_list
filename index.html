<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Attendance Form</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .checkbox-cell {
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Attendance Form</h1>
    <table id="attendance-table">
        <thead>
            <tr>
                <th>Present</th>
                <th>Late</th>
                <th>ID</th>
                <th>Name</th>
                <th>Age</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td class="checkbox-cell"><input type="checkbox" name="attendance"></td>
                <td class="checkbox-cell"><input type="checkbox" name="late"></td>
                <td>7-196</td>
                <td>Yichen</td>
                <td>10</td>
            </tr>
            <tr>
                <td class="checkbox-cell"><input type="checkbox" name="attendance"></td>
                <td class="checkbox-cell"><input type="checkbox" name="late"></td>
                <td>7-196</td>
                <td>Kevin</td>
                <td>8</td>
            </tr>
            <tr>
                <td class="checkbox-cell"><input type="checkbox" name="attendance"></td>
                <td class="checkbox-cell"><input type="checkbox" name="late"></td>
                <td>4-301</td>
                <td>Hannah</td>
                <td>10</td>
            </tr>
            <tr>
                <td class="checkbox-cell"><input type="checkbox" name="attendance"></td>
                <td class="checkbox-cell"><input type="checkbox" name="late"></td>
                <td>7-348</td>
                <td>Henry</td>
                <td>8</td>
            </tr>
            <tr>
                <td class="checkbox-cell"><input type="checkbox" name="attendance"></td>
                <td class="checkbox-cell"><input type="checkbox" name="late"></td>
                <td>7-348</td>
                <td>Luna</td>
                <td>6</td>
            </tr>
            <tr>
                <td class="checkbox-cell"><input type="checkbox" name="attendance"></td>
                <td class="checkbox-cell"><input type="checkbox" name="late"></td>
                <td>4-383</td>
                <td>Joshua</td>
                <td>7</td>
            </tr>
            <tr>
                <td class="checkbox-cell"><input type="checkbox" name="attendance"></td>
                <td class="checkbox-cell"><input type="checkbox" name="late"></td>
                <td>2-299</td>
                <td>Winchell</td>
                <td>9</td>
            </tr>
            <tr>
                <td class="checkbox-cell"><input type="checkbox" name="attendance"></td>
                <td class="checkbox-cell"><input type="checkbox" name="late"></td>
                <td>7-384</td>
                <td>Morgan</td>
                <td>8</td>
            </tr>
            <tr>
                <td class="checkbox-cell"><input type="checkbox" name="attendance"></td>
                <td class="checkbox-cell"><input type="checkbox" name="late"></td>
                <td>1-20</td>
                <td>Kaitlyn</td>
                <td>8</td>
            </tr>
            <tr>
                <td class="checkbox-cell"><input type="checkbox" name="attendance"></td>
                <td class="checkbox-cell"><input type="checkbox" name="late"></td>
                <td>4-408</td>
                <td>Zeen</td>
                <td>13</td>
            </tr>
            <tr>
                <td class="checkbox-cell"><input type="checkbox" name="attendance"></td>
                <td class="checkbox-cell"><input type="checkbox" name="late"></td>
                <td>4-149</td>
                <td>Shiqi</td>
                <td>11</td>
            </tr>
            <tr>
                <td class="checkbox-cell"><input type="checkbox" name="attendance"></td>
                <td class="checkbox-cell"><input type="checkbox" name="late"></td>
                <td>4-149</td>
                <td>Shiwei</td>
                <td>11</td>
            </tr>
            <tr>
                <td class="checkbox-cell"><input type="checkbox" name="attendance"></td>
                <td class="checkbox-cell"><input type="checkbox" name="late"></td>
                <td>7-95</td>
                <td>Cindy</td>
                <td>8</td>
            </tr>
            <tr>
                <td class="checkbox-cell"><input type="checkbox" name="attendance"></td>
                <td class="checkbox-cell"><input type="checkbox" name="late"></td>
                <td>8-216</td>
                <td>Nora</td>
                <td>8</td>
            </tr>
            <tr>
                <td class="checkbox-cell"><input type="checkbox" name="attendance"></td>
                <td class="checkbox-cell"><input type="checkbox" name="late"></td>
                <td>8-162</td>
                <td>Sally</td>
                <td>8</td>
            </tr>
            <tr>
                <td class="checkbox-cell"><input type="checkbox" name="attendance"></td>
                <td class="checkbox-cell"><input type="checkbox" name="late"></td>
                <td>8-237</td>
                <td>Ethan</td>
                <td>11</td>
            </tr>
            <tr>
                <td class="checkbox-cell"><input type="checkbox" name="attendance"></td>
                <td class="checkbox-cell"><input type="checkbox" name="late"></td>
                <td>8-238</td>
                <td>Mason</td>
                <td>12</td>
            </tr>
            <tr>
                <td class="checkbox-cell"><input type="checkbox" name="attendance"></td>
                <td class="checkbox-cell"><input type="checkbox" name="late"></td>
                <td>7-326</td>
                <td>Regina</td>
                <td>9</td>
            </tr>
            <tr>
                <td class="checkbox-cell"><input type="checkbox" name="attendance"></td>
                <td class="checkbox-cell"><input type="checkbox" name="late"></td>
                <td>7-326</td>
                <td>Angel</td>
                <td>9</td>
            </tr>
        </tbody>
    </table>
    <div class="button-container">
        <button onclick="copyTable()">Create Copy</button>
    </div>
    <div class="button-container">
        <button onclick="sendSummary()">Send Attendance Summary</button>
    </div>

    <!-- Include EmailJS SDK -->
    <script type="text/javascript"
        src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js">
    </script>
    <script type="text/javascript">
        (function(){
            emailjs.init({
                publicKey: "ZVv9zetQyZ0C5Wtcu", // Single initialization
            });
        })();
    </script>

    <script>
    let absentList = [];
    let presentCount = 0;
    let lateCount=0;
    let lateList=[];
    function sendSummary() {
        const rows = document.querySelectorAll("#attendance-table tbody tr");
        console.log("Total rows found:", rows.length); // Debug 1

    rows.forEach((row, index) => {
        const checkbox = row.querySelector('input[name="attendance"]');
        const latebox=row.querySelector('input[name="late"]')
        const name = row.cells[3].textContent;
        
        
        if (checkbox.checked&&!latebox.checked) {
            presentCount++;
        } else if(latebox.checked){
            lateList.push(name);
        }
        else{
            absentList.push(name);
        }
    });

    // Debug 3: Verify calculated values
    
    const message = `
        Summary of Attendance:
        Total Present: ${presentCount}
        Absent: ${absentList.join(", ")}
    `;

    // Debug 4: Check final message
    console.log("Email Content:", message);

    emailjs.send("service_oqynfkb", "template_5w5t07y", {
        from_name: "Attendance System",
        to_email: "jiamingqian420@gmail.com",
        message: message
    }).then(
        response => alert("Email sent successfully!"),
        error => alert(`Email failed: ${error.text}`)
    );
    
}    
function copyTable() {
        console.log("Final Count - Present:", presentCount);
        console.log("Absent List:", absentList);
        console.log("late List",lateList);
        }
    </script>
</body>
</html>
